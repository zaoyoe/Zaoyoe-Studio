/* === æ™ºèƒ½èƒ¶å›Šå®¹å™¨ (Smart Capsule v5.4 - Ghost Fix) === */
.capsule-wrapper {
    position: fixed;
    top: -80px;
    left: 50%;
    transform: translateX(-50%) translateZ(0);
    z-index: 9999;

    /* ğŸ›¡ï¸ ç»ˆæä¿é™©ï¼šæ²¡æœ‰ active ç±»æ—¶å¼ºåˆ¶éšè—ï¼Œé˜²æ­¢å¹½çµèƒ¶å›Š */
    opacity: 0;
    pointer-events: none;

    background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);

    color: #ffffff;
    padding: 10px 20px;
    border-radius: 50px;

    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15),
        0 0 20px rgba(102, 126, 234, 0.4);

    font-size: 14px;
    font-weight: 500;
    letter-spacing: 0.5px;
    white-space: nowrap;
    cursor: pointer;

    display: flex;
    align-items: center;
    gap: 12px;

    transition: top 0.5s cubic-bezier(0.34, 1.56, 0.64, 1),
        transform 0.2s ease,
        background 0.3s ease;

    user-select: none;
    -webkit-user-select: none;
}

.capsule-wrapper.active {
    top: 90px;
    opacity: 1;
    pointer-events: auto;
}

@media (hover: hover) {
    .capsule-wrapper:hover {
        transform: translateX(-50%) scale(1.03);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2),
            0 0 30px rgba(102, 126, 234, 0.6);
    }
}

.capsule-wrapper.warm-theme {
    background: linear-gradient(135deg, rgba(255, 154, 158, 0.95) 0%, rgba(254, 207, 239, 0.95) 100%);
    color: #333333;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1),
        0 0 20px rgba(255, 154, 158, 0.4);
}

.capsule-wrapper.success-theme {
    background: linear-gradient(135deg, rgba(66, 230, 149, 0.95) 0%, rgba(59, 178, 184, 0.95) 100%);
    color: #ffffff;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15),
        0 0 20px rgba(66, 230, 149, 0.4);
}

.capsule-content {
    display: flex;
    align-items: center;
    gap: 8px;
}

.capsule-icon {
    font-size: 16px;
    line-height: 1;
}

/* ç§»é™¤å…³é—­æŒ‰é’® - æ‰€æœ‰å¹³å°ç»Ÿä¸€ä¸æ˜¾ç¤º */
.capsule-close {
    display: none;
}

@media (max-width: 768px) {
    .capsule-wrapper {
        /* å¼ºåˆ¶ä¸æ¢è¡Œï¼Œé˜²æ­¢å†…å®¹æº¢å‡º */
        white-space: nowrap;

        /* è°ƒæ•´ä½ç½®ï¼Œé¿å…é®æŒ¡ */
        top: -50px;

        /* âœ… ç§»åŠ¨ç«¯é€‚é…ï¼šç¼©å°å°ºå¯¸ï¼Œæ›´ç²¾è‡´ */
        padding: 8px 16px;
        gap: 6px;
        font-size: 13px;
        min-height: 36px;
        border-radius: 20px;

        /* å¢å¼ºèƒŒæ™¯ä¸é€æ˜åº¦ï¼Œé˜²æ­¢é€å‡ºä¸‹é¢çš„æ€ªä¸œè¥¿ */
        background: rgba(102, 126, 234, 0.98);
        backdrop-filter: none;
        /* ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ–ï¼Œæœ‰æ—¶ç£¨ç ‚ä¼šå¯¼è‡´æ¸²æŸ“é”™è¯¯ */

        /* æ›´è½»ç›ˆçš„é˜´å½± */
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.12),
            0 0 15px rgba(102, 126, 234, 0.3);

        /* ç¡®ä¿å±‚çº§æœ€é«˜ */
        z-index: 10000 !important;

        /* é™åˆ¶æœ€å¤§å®½åº¦ */
        max-width: 85vw;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .capsule-wrapper.active {
        top: 16px;
        opacity: 1;
        pointer-events: auto;
        /* è·ç¦»é¡¶éƒ¨ç•™å‡ºä¸€ç‚¹ç©ºé—´ */
    }

    .capsule-icon {
        font-size: 14px;
    }
}

/* === Phase 2: æ™ºèƒ½å®šä½é«˜äº®åŠ¨ç”» (v2.0 - ä¼ªå…ƒç´ é‡æ„ç‰ˆ) === */
/* æ ¸å¿ƒåŸç†ï¼šä½¿ç”¨ ::after ä¼ªå…ƒç´ æ‰¿è½½å…‰æ™•ï¼Œå…ƒç´ æœ¬èº«å®Œå…¨ä¸ä¿®æ”¹ï¼Œæœç»é—ªå› */

/* å…‰æ™•å‘¼å¸åŠ¨ç”» - ä»…ä¿®æ”¹ opacity */
@keyframes glow-pulse {
    0% {
        opacity: 0;
    }

    15% {
        opacity: 1;
    }

    40% {
        opacity: 0.15;
    }

    60% {
        opacity: 0.85;
    }

    80% {
        opacity: 0.1;
    }

    100% {
        opacity: 0;
    }
}

/* é«˜äº®åŸºç¡€æ ·å¼ - ä»…è®¾ç½®ç›¸å¯¹å®šä½ï¼Œå®Œå…¨ä¸ä¿®æ”¹ transform/box-shadow */
.message-item.highlight-flash,
.comment-item.highlight-flash {
    position: relative;
    z-index: 10;
}

/* ä¼ªå…ƒç´ å…‰æ™•å±‚ - æ‰€æœ‰åŠ¨ç”»æ•ˆæœéƒ½åœ¨è¿™é‡Œ */
.message-item.highlight-flash::after,
.comment-item.highlight-flash::after {
    content: '';
    position: absolute;
    inset: -10px;
    border-radius: 16px;
    background: transparent;
    box-shadow:
        0 0 35px 14px rgba(102, 126, 234, 0.8),
        0 0 18px 6px rgba(155, 93, 229, 0.55);
    opacity: 0;
    pointer-events: none;
    z-index: -1;
    animation: glow-pulse 3.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* åµŒå¥—è¯„è®ºï¼šç¼©å°å…‰æ™•èŒƒå›´ */
.comment-item--nested.highlight-flash::after {
    inset: -4px;
    border-radius: 8px;
}

/* === ç§»åŠ¨ç«¯ä¼˜åŒ– === */
@media (max-width: 768px) {

    /* ç§»åŠ¨ç«¯ä½¿ç”¨ç›¸åŒçš„ä¼ªå…ƒç´ æ–¹æ¡ˆï¼Œæ— éœ€ç‰¹æ®Šå¤„ç† */
    .message-item.highlight-flash::after,
    .comment-item.highlight-flash::after {
        /* ç¨å¾®å‡å°å…‰æ™•èŒƒå›´ï¼Œé€‚é…å°å±å¹• */
        inset: -4px;
        box-shadow:
            0 0 20px 8px rgba(102, 126, 234, 0.7),
            0 0 10px 3px rgba(155, 93, 229, 0.45);
    }
}