<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Studio | Prompt Gallery</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Outfit:wght@300;400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Styles -->
    <link rel="stylesheet" href="prompts-poetry.css">
    <link rel="stylesheet" href="admin-studio.css?v=3">
    <link rel="stylesheet" href="admin-sidebar.css?v=1">
    <!-- Cropper.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
    <!-- Flatpickr CSS (Base) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <!-- Prevent flash of wrong theme -->
    <script>
        (function () {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
            }
        })();
    </script>
</head>

<body>
    <!-- Admin Layout Container -->
    <div class="admin-layout">
        <!-- Supabase-style Sidebar -->
        <aside class="admin-sidebar" id="adminSidebar">
            <!-- Brand -->
            <div class="sidebar-brand">
                <div class="sidebar-brand-icon">
                    <i class="fas fa-bolt"></i>
                </div>
                <span class="sidebar-brand-text">Admin Studio</span>
            </div>

            <!-- Navigation -->
            <nav class="sidebar-nav">
                <div class="sidebar-item active" data-module="gallery" onclick="switchModule('gallery')">
                    <i class="fas fa-palette"></i>
                    <span>Gallery</span>
                </div>
                <div class="sidebar-item" data-module="comments" onclick="switchModule('comments')">
                    <i class="fas fa-comments"></i>
                    <span>ËØÑËÆ∫ÁÆ°ÁêÜ</span>
                </div>
                <div class="sidebar-divider"></div>
                <div class="sidebar-item disabled" data-module="points">
                    <i class="fas fa-coins"></i>
                    <span>ÁßØÂàÜÁ≥ªÁªü</span>
                    <span class="coming-soon">Âç≥Â∞ÜÊé®Âá∫</span>
                </div>
                <div class="sidebar-item disabled" data-module="analytics">
                    <i class="fas fa-chart-line"></i>
                    <span>Êï∞ÊçÆÂàÜÊûê</span>
                    <span class="coming-soon">Âç≥Â∞ÜÊé®Âá∫</span>
                </div>
            </nav>

            <!-- Footer (Settings) -->
            <div class="sidebar-footer">
                <div class="sidebar-item" data-module="settings" onclick="switchModule('settings')">
                    <i class="fas fa-cog"></i>
                    <span>ËÆæÁΩÆ</span>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="admin-main-content">
            <!-- Ambient Light Canvas -->
            <canvas id="ambientCanvas"></canvas>
            <!-- Starry Sky Canvas (Dark Mode Only) -->
            <canvas id="starryCanvas"></canvas>

            <!-- Header -->
            <header class="studio-header">
                <a href="prompts.html" class="back-link">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back to Gallery</span>
                </a>
                <h1 class="studio-title">
                    <i class="fas fa-palette"></i>
                    Admin Studio
                </h1>
                <div class="header-right">
                    <div id="apiKeySelector" class="api-key-selector">
                        <!-- Rendered by JavaScript -->
                    </div>
                    <div class="studio-status" id="studioStatus">
                        <span class="status-dot"></span>
                        <span class="status-text">Ready</span>
                    </div>
                </div>
            </header>

            <!-- ========== GALLERY MODULE ========== -->
            <div id="module-gallery" class="module-container active">
                <!-- Tab Navigation -->
                <nav class="admin-tabs">
                    <button class="admin-tab active" data-view="create" onclick="switchView('create')">Create</button>
                    <button class="admin-tab" data-view="manage" onclick="switchView('manage')">Manage</button>
                </nav>

                <!-- Main Content -->

                <div class="studio-main">
                    <!-- CREATE VIEW -->
                    <div id="view-create" class="view-section active">
                        <!-- Batch Edit Switcher (only visible in batch edit mode) -->
                        <div class="batch-edit-bar" id="batchEditBar" style="display: none;">

                            <div class="batch-edit-dropdown" id="batchEditDropdown">
                                <button class="batch-edit-current" id="batchEditCurrent">
                                    <span class="current-title">ÈÄâÊã©ÊèêÁ§∫ËØç...</span>
                                    <span class="current-index">(0/0)</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="batch-edit-menu" id="batchEditMenu">
                                    <!-- Dynamically populated -->
                                </div>
                            </div>
                            <button class="batch-edit-close" id="batchEditClose" title="ÈÄÄÂá∫ÊâπÈáèÁºñËæë">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <!-- Upload Section -->
                        <section class="upload-section glass-panel">
                            <h2 class="section-title">
                                <i class="fas fa-cloud-upload-alt"></i>
                                Upload Images
                            </h2>

                            <div class="upload-zone" id="uploadZone">
                                <div class="upload-icon">
                                    <i class="fas fa-images"></i>
                                </div>
                                <p class="upload-text">Drag & drop images here</p>
                                <p class="upload-subtext">or click to browse</p>
                                <input type="file" id="fileInput" multiple accept="image/*" hidden>
                            </div>

                            <!-- Image Preview Grid -->
                            <div class="preview-grid" id="previewGrid">
                                <!-- Dynamically populated -->
                            </div>
                        </section>

                        <!-- AI Analysis Section -->
                        <section class="analysis-section glass-panel">
                            <h2 class="section-title">
                                <i class="fas fa-robot"></i>
                                AI Analysis
                                <button class="analyze-btn" id="analyzeBtn" disabled>Analyze</button>
                            </h2>

                            <!-- Loading State - Elegant Neural Animation -->
                            <div class="analysis-loading" id="analysisLoading" style="display: none;">
                                <div class="neural-loader">
                                    <div class="neural-dot"></div>
                                    <div class="neural-dot"></div>
                                    <div class="neural-dot"></div>
                                    <div class="neural-dot"></div>
                                    <div class="neural-dot"></div>
                                </div>
                            </div>

                            <!-- Results Form -->
                            <form class="prompt-form" id="promptForm" style="display: none;">
                                <!-- Title -->
                                <div class="form-group">
                                    <label for="promptTitle">
                                        <i class="fas fa-heading"></i>
                                        Title
                                        <span class="ai-badge">AI Generated</span>
                                        <!-- Last Edited Info (shown only in edit mode) -->
                                        <span class="last-edited-info" id="lastEditedInfo" style="display: none;">
                                            <i class="fas fa-clock"></i>
                                            <time id="lastEditedTime"></time>
                                        </span>
                                    </label>
                                    <input type="text" id="promptTitle" placeholder="Enter prompt title...">
                                </div>

                                <!-- Category -->
                                <div class="form-group">
                                    <label for="promptCategory">
                                        <i class="fas fa-folder"></i>
                                        Category
                                        <span class="ai-badge">AI Detected</span>
                                    </label>
                                    <!-- Custom Dropdown -->
                                    <div class="custom-select" id="categoryDropdown">
                                        <input type="hidden" id="promptCategory" name="promptCategory" value="">
                                        <div class="select-display" id="categoryDisplay">
                                            <span class="select-text">Select category...</span>
                                            <i class="fas fa-chevron-down select-arrow"></i>
                                        </div>
                                        <div class="select-options" id="categoryOptions">
                                            <div class="select-option" data-value="">Select category...</div>
                                            <div class="select-option" data-value="Photography">Photography</div>
                                            <div class="select-option" data-value="Illustration">Illustration</div>
                                            <div class="select-option" data-value="3D Art">3D Art</div>
                                            <div class="select-option" data-value="Miniature">Miniature</div>
                                            <div class="select-option" data-value="Creative">Creative</div>
                                            <div class="select-option" data-value="Animation">Animation</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Prompt Text -->
                                <div class="form-group">
                                    <label for="promptText">
                                        <i class="fas fa-terminal"></i>
                                        Prompt Text
                                    </label>
                                    <textarea id="promptText" rows="6"
                                        placeholder="Enter the prompt text used to generate this image..."></textarea>
                                </div>

                                <!-- Description (Hidden - still analyzed in background) -->
                                <div class="form-group" style="display: none;">
                                    <label for="promptDescription">
                                        <i class="fas fa-align-left"></i>
                                        Description
                                        <span class="ai-badge">AI Generated</span>
                                    </label>
                                    <textarea id="promptDescription" rows="3"
                                        placeholder="Brief description..."></textarea>
                                </div>

                                <!-- AI Tags Display (Hidden - still analyzed in background) -->
                                <div class="form-group" style="display: none;">
                                    <label>
                                        <i class="fas fa-tags"></i>
                                        AI Tags
                                        <span class="ai-badge">Auto-generated</span>
                                    </label>
                                    <div class="tags-container">
                                        <div class="tag-category">
                                            <span class="tag-label">Objects:</span>
                                            <div class="tag-list" id="tagObjects"></div>
                                        </div>
                                        <div class="tag-category">
                                            <span class="tag-label">Scenes:</span>
                                            <div class="tag-list" id="tagScenes"></div>
                                        </div>
                                        <div class="tag-category">
                                            <span class="tag-label">Styles:</span>
                                            <div class="tag-list" id="tagStyles"></div>
                                        </div>
                                        <div class="tag-category">
                                            <span class="tag-label">Mood:</span>
                                            <div class="tag-list" id="tagMood"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Dominant Colors (Hidden - still analyzed in background) -->
                                <div class="form-group" style="display: none;">
                                    <label>
                                        <i class="fas fa-palette"></i>
                                        Dominant Colors
                                        <span class="ai-badge">Extracted</span>
                                    </label>
                                    <div class="color-swatches" id="colorSwatches"></div>
                                </div>

                                <!-- Submit Button -->
                                <div class="form-actions">
                                    <button type="button" class="btn-secondary" onclick="resetForm()">
                                        <i class="fas fa-undo"></i>
                                        Reset
                                    </button>
                                    <button type="submit" class="btn-primary" id="saveBtn">
                                        <span class="btn-text">
                                            <i class="fas fa-save"></i>
                                            Save to Gallery
                                        </span>
                                        <div class="dot-matrix-container">
                                            <div class="dot-matrix" id="dotMatrix">
                                                <!-- 30 dots: 10 columns x 3 rows -->
                                            </div>
                                        </div>
                                    </button>
                                </div>
                            </form>
                        </section>
                    </div>
                    <!-- END CREATE VIEW -->

                    <!-- MANAGE VIEW -->
                    <div id="view-manage" class="view-section">
                        <!-- Search Toolbar -->
                        <div class="manage-toolbar">
                            <!-- Search Bar with Dropdown Wrapper -->
                            <div class="admin-search-wrapper">
                                <div class="admin-search">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="adminSearchInput" placeholder="Search prompts..."
                                        autocomplete="off">
                                </div>
                                <!-- Search Dropdown -->
                                <div class="search-dropdown" id="adminSearchDropdown">
                                    <!-- Autocomplete Suggestions (shown when typing) -->
                                    <div class="search-suggestions" id="searchSuggestions" style="display: none;">
                                        <!-- Dynamically generated -->
                                    </div>
                                </div>
                            </div>
                            <div class="filter-group">
                                <!-- Category Filter - Custom Dropdown -->
                                <div class="custom-select filter-custom-select" id="categoryFilterDropdown">
                                    <input type="hidden" id="categoryFilter" name="categoryFilter" value="">
                                    <div class="select-display">
                                        <span class="select-text">All</span>
                                        <i class="fas fa-chevron-down select-arrow"></i>
                                    </div>
                                    <div class="select-options">
                                        <div class="select-option selected" data-value="">All</div>
                                        <div class="select-option" data-value="Photography">Photography</div>
                                        <div class="select-option" data-value="3D Art">3D Art</div>
                                        <div class="select-option" data-value="Illustration">Illustration</div>
                                        <div class="select-option" data-value="Creative">Creative</div>
                                        <div class="select-option" data-value="Miniature">Miniature</div>
                                        <div class="select-option" data-value="Animation">Animation</div>
                                    </div>
                                </div>
                                <!-- Date Filter - Custom Dropdown -->
                                <div class="custom-select filter-custom-select" id="dateFilterDropdown">
                                    <input type="hidden" id="dateFilter" name="dateFilter" value="">
                                    <div class="select-display">
                                        <span class="select-text">All</span>
                                        <i class="fas fa-chevron-down select-arrow"></i>
                                    </div>
                                    <div class="select-options">
                                        <div class="select-option selected" data-value="">All</div>
                                        <div class="select-option" data-value="today">Today</div>
                                        <div class="select-option" data-value="week">Week</div>
                                        <div class="select-option" data-value="month">Month</div>
                                    </div>
                                </div>
                            </div>
                            <!-- Batch Actions -->
                            <div class="batch-actions-wrapper" id="batchActionsWrapper">
                                <button class="batch-btn" id="selectModeBtn" title="ÈÄâÊã©Ê®°Âºè">
                                    <i class="fas fa-check-square"></i>
                                </button>
                                <div class="batch-menu-container" id="batchMenuContainer" style="display: none;">
                                    <button class="batch-btn" id="batchMenuTrigger" title="ÊâπÈáèÊìç‰Ωú">
                                        <i class="fas fa-ellipsis-h"></i>
                                    </button>
                                    <div class="batch-dropdown-menu" id="batchDropdownMenu">
                                        <div class="batch-menu-item" id="selectAllBtn">
                                            <i class="fas fa-check-double"></i>
                                            <span>ÂÖ®ÈÄâ</span>
                                        </div>
                                        <div class="batch-menu-item" id="batchEditMenuItem">
                                            <i class="fas fa-edit"></i>
                                            <span>ÊâπÈáèÁºñËæë</span>
                                        </div>
                                        <div class="batch-menu-item" id="batchReanalyzeMenuItem">
                                            <i class="fas fa-sync-alt"></i>
                                            <span>ÊâπÈáèÈáçÂàÜÊûê</span>
                                        </div>
                                        <div class="batch-menu-item" id="analyzeUntaggedMenuItem">
                                            <i class="fas fa-tags"></i>
                                            <span>Ë°•ÂÖÖÊ†áÁ≠æ</span>
                                        </div>
                                        <div class="batch-menu-divider"></div>
                                        <div class="batch-menu-item danger" id="batchDeleteMenuItem">
                                            <i class="fas fa-trash-alt"></i>
                                            <span>ÊâπÈáèÂà†Èô§</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="prompt-count" id="promptCountWrapper" style="display: none;">
                                <span class="select-count">Â∑≤ÈÄâ <span id="selectedCount">0</span> È°π</span>
                            </div>
                        </div>
                        <div class="admin-grid" id="adminGrid">
                            <!-- Dynamically loaded -->
                        </div>
                    </div>
                    <!-- END MANAGE VIEW -->
                </div>
                <!-- END studio-main -->
            </div>
            <!-- END GALLERY MODULE -->

            <!-- ========== COMMENTS MODULE ========== -->
            <div id="module-comments" class="module-container">
                <div class="module-content">
                    <!-- Comment Tabs -->
                    <nav class="admin-tabs">
                        <button class="admin-tab active" data-comment-view="guestbook"
                            onclick="switchCommentView('guestbook')">ÁïôË®ÄÊùø</button>
                        <button class="admin-tab" data-comment-view="gallery"
                            onclick="switchCommentView('gallery')">ÁîªÂªäËØÑËÆ∫</button>
                    </nav>

                    <!-- Stats moved to Analytics module -->
                    <!-- Unified Compact Toolbar -->
                    <div class="comment-toolbar-compact">
                        <!-- Left: Search + Filters -->
                        <div class="toolbar-left">
                            <div class="search-pill">
                                <i class="fas fa-search"></i>
                                <input type="text" id="commentSearch" placeholder="ÊêúÁ¥¢ËØÑËÆ∫...">
                            </div>

                            <!-- Filter Dropdowns -->
                            <div class="filter-dropdowns">
                                <!-- Date Filter -->
                                <div class="filter-dropdown" data-filter="date">
                                    <button class="filter-btn">
                                        <i class="fas fa-calendar-alt"></i>
                                        <span class="filter-label">Êó•Êúü</span>
                                        <i class="fas fa-chevron-down filter-arrow"></i>
                                    </button>
                                    <div class="filter-popup glass-popup">
                                        <div class="filter-option selected" data-value="all">ÂÖ®ÈÉ®Êó∂Èó¥</div>
                                        <div class="filter-option" data-value="today">‰ªäÂ§©</div>
                                        <div class="filter-option" data-value="week">Êú¨Âë®</div>
                                        <div class="filter-option" data-value="month">Êú¨Êúà</div>
                                        <div class="filter-divider"></div>
                                        <div class="filter-custom-date">
                                            <label>Ëá™ÂÆö‰πâËåÉÂõ¥</label>
                                            <input type="text" id="filterDateFrom" class="flatpickr-input"
                                                placeholder="ÂºÄÂßãÊó∂Èó¥" readonly>
                                            <span>Ëá≥</span>
                                            <input type="text" id="filterDateTo" class="flatpickr-input"
                                                placeholder="ÁªìÊùüÊó∂Èó¥" readonly>
                                        </div>
                                    </div>
                                </div>

                                <!-- Status Filter (ÂõûÂ§çÊÉÖÂÜµ) -->
                                <div class="filter-dropdown" data-filter="status">
                                    <button class="filter-btn">
                                        <i class="fas fa-reply-all"></i>
                                        <span class="filter-label">ÂõûÂ§ç</span>
                                        <i class="fas fa-chevron-down filter-arrow"></i>
                                    </button>
                                    <div class="filter-popup glass-popup">
                                        <div class="filter-option selected" data-value="all">ÂÖ®ÈÉ®</div>
                                        <div class="filter-option" data-value="replied">ÊúâÂõûÂ§ç</div>
                                        <div class="filter-option" data-value="unreplied">Êó†ÂõûÂ§ç</div>
                                    </div>
                                </div>

                                <!-- Type Filter (Â±ÇÁ∫ß) -->
                                <div class="filter-dropdown" data-filter="type">
                                    <button class="filter-btn">
                                        <i class="fas fa-layer-group"></i>
                                        <span class="filter-label">Â±ÇÁ∫ß</span>
                                        <i class="fas fa-chevron-down filter-arrow"></i>
                                    </button>
                                    <div class="filter-popup glass-popup">
                                        <div class="filter-option selected" data-value="all">ÂÖ®ÈÉ®</div>
                                        <div class="filter-option" data-value="top">‰∏ªËØÑËÆ∫</div>
                                        <div class="filter-option" data-value="reply">Â≠êÂõûÂ§ç</div>
                                        <div class="filter-divider"></div>
                                        <label class="filter-checkbox">
                                            <input type="checkbox" id="filterHasImage">
                                            <span>Âê´ÂõæÁâá</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Export Dropdown (New) -->
                                <div class="filter-dropdown" data-filter="export">
                                    <button class="filter-btn export-btn-trigger">
                                        <i class="fas fa-file-export"></i>
                                        <span class="filter-label">ÂØºÂá∫</span>
                                        <i class="fas fa-chevron-down filter-arrow"></i>
                                    </button>
                                    <div class="filter-popup glass-popup export-popup">
                                        <div class="filter-option" onclick="exportData('csv')">
                                            <i class="fas fa-file-csv"></i> ÂØºÂá∫ CSV
                                        </div>
                                        <div class="filter-option" onclick="exportData('json')">
                                            <i class="fas fa-file-code"></i> ÂØºÂá∫ JSON
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right: View Toggle + Selection + Batch Delete -->
                        <div class="toolbar-right">
                            <!-- View Toggle -->
                            <div class="view-toggle">
                                <button class="view-btn active" data-view="grid" onclick="switchLayoutView('grid')"
                                    title="ÁΩëÊ†ºËßÜÂõæ">
                                    <i class="fas fa-th-large"></i>
                                </button>
                                <button class="view-btn" data-view="list" onclick="switchLayoutView('list')"
                                    title="ÂàóË°®ËßÜÂõæ">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>

                            <div class="divider-vertical"></div>

                            <label class="select-checkbox-compact">
                                <input type="checkbox" id="selectAllComments" onchange="toggleSelectAll()">
                                <span id="selectionCount">0</span>
                            </label>
                            <button class="batch-delete-pill" id="batchDeleteBtn" disabled
                                onclick="batchDeleteComments()">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Active Filter Tags -->
                    <div id="activeFilterTags" class="filter-tags-container"></div>

                    <!-- Comment List -->
                    <div class="comment-list-admin" id="adminCommentList">
                        <p class="loading-text">Âä†ËΩΩ‰∏≠...</p>
                    </div>
                </div>
            </div>
            <!-- END COMMENTS MODULE -->

            <!-- ========== SETTINGS MODULE ========== -->
            <div id="module-settings" class="module-container">
                <div class="module-header">
                    <h2><i class="fas fa-cog"></i> ËÆæÁΩÆ</h2>
                </div>
                <div class="module-content">
                    <!-- API Key Section -->
                    <div class="settings-section">
                        <h3><i class="fas fa-key"></i> API ÈÖçÁΩÆ</h3>
                        <div class="settings-item">
                            <label>Gemini API Key</label>
                            <div class="settings-input-group">
                                <input type="password" id="settingsApiKey" placeholder="sk-..." readonly>
                                <button class="btn-secondary" onclick="promptForApiKey()">
                                    <i class="fas fa-edit"></i> ‰øÆÊîπ
                                </button>
                            </div>
                            <p class="settings-status" id="apiKeyStatus">
                                <span class="status-dot"></span>
                                <span>Ê£ÄÊµã‰∏≠...</span>
                            </p>
                        </div>
                    </div>

                    <!-- Coming Soon Section -->
                    <div class="settings-section coming-soon-section">
                        <h3><i class="fas fa-rocket"></i> Êõ¥Â§öËÆæÁΩÆ</h3>
                        <div class="coming-soon-items">
                            <div class="coming-soon-item">
                                <i class="fas fa-users-cog"></i>
                                <span>ÁÆ°ÁêÜÂëòÊùÉÈôê</span>
                            </div>
                            <div class="coming-soon-item">
                                <i class="fas fa-filter"></i>
                                <span>ÊïèÊÑüËØçËøáÊª§</span>
                            </div>
                            <div class="coming-soon-item">
                                <i class="fas fa-download"></i>
                                <span>Êï∞ÊçÆÂØºÂá∫</span>
                            </div>
                            <div class="coming-soon-item">
                                <i class="fas fa-bell"></i>
                                <span>ÈÄöÁü•ËÆæÁΩÆ</span>
                            </div>
                        </div>
                        <p class="coming-soon-note">üöÄ Êõ¥Â§öÂäüËÉΩÂç≥Â∞ÜÊé®Âá∫</p>
                    </div>
                </div>
            </div>
            <!-- END SETTINGS MODULE -->

            <!-- Batch Progress Modal -->
            <div class="batch-modal-overlay" id="batchProgressOverlay" style="display: none;">
                <div class="batch-modal">
                    <h3 class="batch-modal-title" id="batchModalTitle">ÊâπÈáèÈáçÂàÜÊûê</h3>
                    <div class="batch-modal-body">
                        <p class="batch-current-item" id="batchCurrentItem">Ê≠£Âú®ÂàÜÊûê...</p>
                        <div class="batch-progress-bar">
                            <div class="batch-progress-fill" id="batchProgressFill"></div>
                        </div>
                        <p class="batch-progress-text" id="batchProgressText">0/0 (0%)</p>
                        <p class="batch-time-remaining" id="batchTimeRemaining">È¢ÑËÆ°Ââ©‰Ωô: --</p>
                    </div>
                    <div class="batch-modal-actions">
                        <button class="btn-secondary" id="batchPauseBtn">
                            <i class="fas fa-pause"></i> ÊöÇÂÅú
                        </button>
                        <button class="btn-danger" id="batchCancelBtn">
                            <i class="fas fa-times"></i> ÂèñÊ∂à
                        </button>
                    </div>
                </div>
            </div>

            <!-- Delete Confirmation Modal -->
            <div class="batch-modal-overlay" id="deleteConfirmOverlay" style="display: none;">
                <div class="batch-modal confirm-modal">
                    <h3 class="batch-modal-title">‚ö†Ô∏è Á°ÆËÆ§Âà†Èô§</h3>
                    <div class="batch-modal-body">
                        <p id="deleteConfirmText">Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ 0 ‰∏™ÊèêÁ§∫ËØçÂêóÔºü</p>
                        <p class="warn-text">Ê≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄÔºÅ</p>
                    </div>
                    <div class="batch-modal-actions">
                        <button class="btn-secondary" id="deleteConfirmCancel">ÂèñÊ∂à</button>
                        <button class="btn-danger" id="deleteConfirmOk">Á°ÆËÆ§Âà†Èô§</button>
                    </div>
                </div>
            </div>

            <!-- Image Preview Lightbox -->
            <div class="lightbox-overlay" id="lightboxOverlay" style="display: none;">
                <button class="lightbox-close" id="lightboxClose"><i class="fas fa-times"></i></button>
                <img class="lightbox-image" id="lightboxImage" src="" alt="Preview">
            </div>

            <!-- Crop Modal -->
            <div class="batch-modal-overlay" id="cropModalOverlay" style="display: none;">
                <div class="batch-modal crop-modal">
                    <h3 class="batch-modal-title">‚úÇÔ∏è Ë£ÅÂàáÂõæÁâá</h3>
                    <div class="crop-aspect-buttons">
                        <button class="crop-aspect-btn active" data-aspect="free">Ëá™Áî±</button>
                        <button class="crop-aspect-btn" data-aspect="1">1:1</button>
                        <button class="crop-aspect-btn" data-aspect="0.75">3:4</button>
                        <button class="crop-aspect-btn" data-aspect="1.333">4:3</button>
                        <button class="crop-aspect-btn" data-aspect="0.5625">9:16</button>
                        <button class="crop-aspect-btn" data-aspect="1.777">16:9</button>
                    </div>
                    <div class="crop-container" id="cropContainer">
                        <img id="cropImage" src="" alt="Crop">
                    </div>
                    <div class="batch-modal-actions">
                        <button class="btn-secondary" id="cropCancel">ÂèñÊ∂à</button>
                        <button class="btn-primary" id="cropApply">Â∫îÁî®Ë£ÅÂàá</button>
                    </div>
                </div>
            </div>

            <!-- Toast Notifications -->
            <div class="toast-container" id="toastContainer"></div>
        </div>
        <!-- END admin-main-content -->
    </div>
    <!-- END admin-layout -->

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Cropper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
    <script>
        // Initialize Supabase client
        const SUPABASE_URL = 'https://mmkugdibsaeoevliebzk.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_lwkiF-sQ80z8e9oMcejFPQ_j7oezjcF';
        window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Module switching function
        function switchModule(moduleName) {
            // Skip disabled modules
            const clickedItem = document.querySelector(`[data-module="${moduleName}"]`);
            if (clickedItem && clickedItem.classList.contains('disabled')) {
                return;
            }

            // Update sidebar active state
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            if (clickedItem) {
                clickedItem.classList.add('active');
            }

            // Switch module containers
            document.querySelectorAll('.module-container').forEach(container => {
                container.classList.remove('active');
            });
            const targetModule = document.getElementById(`module-${moduleName}`);
            if (targetModule) {
                targetModule.classList.add('active');
            }

            // Module-specific initialization
            if (moduleName === 'comments' && typeof initCommentsModule === 'function') {
                initCommentsModule();
            } else if (moduleName === 'settings' && typeof initSettingsModule === 'function') {
                initSettingsModule();
            }
        }

        // Comment view switching
        function switchCommentView(view) {
            document.querySelectorAll('[data-comment-view]').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-comment-view="${view}"]`)?.classList.add('active');

            if (typeof loadComments === 'function') {
                loadComments(view);
            }
        }
    </script>
    <script src="starry-sky.js"></script>
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh.js"></script>
    <script src="admin-comments.js"></script>
    <script src="admin-studio.js"></script>
</body>

</html>