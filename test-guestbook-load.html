<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Guestbook Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <h1>Guestbook Messages Test</h1>
    <div id="result"></div>
    <div id="messageContainer"></div>

    <script>
        const SUPABASE_URL = 'https://mmkugdibsaeoevliebzk.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_lwkiF-sQ80z8e9oMcejFPQ_j7oezjcF';
        window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function testLoad() {
            console.log('Starting test...');
            const resultDiv = document.getElementById('result');
            const container = document.getElementById('messageContainer');

            try {
                // Fetch messages
                const { data: messages, error } = await window.supabaseClient
                    .from('guestbook_messages')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(50);

                console.log('Messages:', messages);
                console.log('Error:', error);

                if (error) {
                    resultDiv.innerHTML = `<p style="color:red">Error: ${error.message}</p>`;
                    return;
                }

                resultDiv.innerHTML = `<p style="color:green">Found ${messages.length} messages!</p>`;

                // Simple display
                messages.forEach(msg => {
                    const div = document.createElement('div');
                    div.style.cssText = 'border:1px solid #ccc; padding:10px; margin:10px 0; background:#f5f5f5;';
                    div.innerHTML = `
                        <strong>ID:</strong> ${msg.id}<br>
                        <strong>Content:</strong> ${msg.content}<br>
                        <strong>User ID:</strong> ${msg.user_id}<br>
                        <strong>Created:</strong> ${msg.created_at}
                    `;
                    container.appendChild(div);
                });

            } catch (err) {
                resultDiv.innerHTML = `<p style="color:red">Exception: ${err.message}</p>`;
                console.error(err);
            }
        }

        // Auto-run
        testLoad();
    </script>
</body>

</html>